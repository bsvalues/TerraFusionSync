# TerraFusion SyncService Architecture

## Service Architecture Diagram

```
+----------------------------------------------------------+
|                      CLIENT                              |
+--------------------------|-------------------------------+
                           | HTTP Request
                           v
+----------------------------------------------------------+
|                                                          |
|      +--------+    API Gateway (Flask, Port 5000)        |
|      |        |                                          |
|      |  API   |    - Authentication                      |
|      |        |    - Request Routing                     |
|      +--------+    - Service Management                  |
|                                                          |
+--------------------------|-------------------------------+
                           | HTTP Forward
                           v
+----------------------------------------------------------+
|                                                          |
|      SyncService API (FastAPI, Port 8000)                |
|                                                          |
|  +------------+   +-------------+   +------------+       |
|  |            |   |             |   |            |       |
|  |   Change   |-->| Transformer |-->| Validator  |       |
|  |  Detector  |   |             |   |            |       |
|  |            |   |             |   |            |       |
|  +------------+   +-------------+   +------------+       |
|        ^                                   |             |
|        |                                   v             |
|  +------------+                    +------------+        |
|  |            |                    |            |        |
|  |   Source   |                    |   Self     |        |
|  |   System   |<-------------------| Healing    |        |
|  |  Adapters  |                    |Orchestrator|        |
|  |            |                    |            |        |
|  +------------+                    +------------+        |
|        ^                                   |             |
|        |                                   v             |
|  +------------+                    +------------+        |
|  |            |                    |            |        |
|  | Monitoring |                    |   Target   |        |
|  |   System   |                    |   System   |        |
|  |            |                    |  Adapters  |        |
|  +------------+                    +------------+        |
|                                                          |
+----------------------------------------------------------+
                           |
                           v
+----------------------------------------------------------+
|                 EXTERNAL SYSTEMS                          |
|                                                          |
|  +------------+  +------------+  +------------+          |
|  |            |  |            |  |            |          |
|  |    PACS    |  |    CAMA    |  |    GIS     |          |
|  |            |  |            |  |            |          |
|  +------------+  +------------+  +------------+          |
|                                                          |
|  +------------+  +------------+  +------------+          |
|  |            |  |            |  |            |          |
|  |    ERP     |  |    CRM     |  |   Other    |          |
|  |            |  |            |  |  Systems   |          |
|  +------------+  +------------+  +------------+          |
|                                                          |
+----------------------------------------------------------+
```

## Service Startup Sequence

```
+---------------------+         +----------------------+
|                     |         |                      |
|   Start Replit      |         |   .replit defines    |
|   Project           +-------->+   Start application  |
|                     |         |   workflow           |
|                     |         |                      |
+---------------------+         +----------+-----------+
                                           |
                                           |
                                           v
+---------------------+         +----------------------+
|                     |         |                      |
|   check_sync        |<--------+  Main Flask app      |
|   service_status    |         |  starts on port 5000 |
|                     |         |                      |
+--------+------------+         +----------------------+
         |
         | If not running
         v
+---------------------+         +----------------------+
|                     |         |                      |
|   ensure_sync       +-------->+   run_syncservice    |
|   service_running   |         |   _direct.py         |
|                     |         |                      |
+---------------------+         +----------+-----------+
                                           |
                                           |
                                           v
                                +----------------------+
                                |                      |
                                |  SyncService starts  |
                                |  on port 8000        |
                                |                      |
                                +----------------------+
```

## Data Flow for Synchronization

```
+----------------+    +----------------+    +----------------+
|                |    |                |    |                |
|  Source System +---->  Change        +---->  Source        |
|  (PACS, etc.)  |    |  Detection     |    |  Records       |
|                |    |                |    |                |
+----------------+    +----------------+    +-------+--------+
                                                   |
                                                   v
+----------------+    +----------------+    +----------------+
|                |    |                |    |                |
|   Validated    <----+  Validation    <----+  Transformation|
|   Records      |    |  Process       |    |  Process       |
|                |    |                |    |                |
+-------+--------+    +----------------+    +----------------+
        |
        v
+----------------+    +----------------+    +----------------+
|                |    |                |    |                |
|  Self-Healing  +---->  Target System +---->  Sync          |
|  Orchestration |    |  Update        |    |  Complete      |
|                |    |                |    |                |
+----------------+    +----------------+    +----------------+
```

## Gateway-to-SyncService Communication

```
+-----------------------------------------------------+
|                                                     |
|  API Gateway (Flask, Port 5000)                     |
|                                                     |
|  +--------------+      +-----------------------+    |
|  |              |      |                       |    |
|  |  Client      |      |  SyncService          |    |
|  |  Request     +----->+  Request              |    |
|  |  Handler     |      |  Forwarder            |    |
|  |              |      |                       |    |
|  +--------------+      +----------+------------+    |
|                                   |                 |
+-----------------------------------|-----------------|
                                    |
                                    | HTTP Forward
                                    | (localhost:8000)
                                    v
+-----------------------------------------------------+
|                                                     |
|  SyncService API (FastAPI, Port 8000)               |
|                                                     |
|  +--------------+      +-----------------------+    |
|  |              |      |                       |    |
|  |  Request     |      |  Business Logic       |    |
|  |  Router      +----->+  Processing           |    |
|  |              |      |                       |    |
|  +--------------+      +-----------------------+    |
|                                                     |
+-----------------------------------------------------+
```